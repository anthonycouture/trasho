<%- include('header', {title: 'Trasho - Confirmation mail'})%>
    <style>
        body{
            background-color: #93d12e;
        }
        #all{
            text-align: center;
            margin : 0 auto;
        }
        h1{
            margin-top: 0;
        }
    </style>
</head 

<body>
    <div id="all">
        <img alt="Trasho Logo" src="https://i.ibb.co/WGzKX8k/logo-Convert-Image.png" id="logo"/>
        <h1>Bienvenue chez Trasho</h1> 
        <p id="text">Vérification de votre inscription...</p>
    </div>

    <script>
        const text = document.querySelector("#text");
        var checkToken = new XMLHttpRequest();
        checkToken.open("GET", JSON.parse('<%- api_user %>') + "/token/" + JSON.parse('<%- token %>'), false);
        checkToken.send(null);
        if(checkToken.responseText == ""){
            text.innerHTML = "Votre compte n'existe pas.";
            throw 'Votre compte n\'existe pas.';
        }

        var noExpiredToken = new XMLHttpRequest();
        noExpiredToken.open("GET", JSON.parse('<%- api_user %>') + "/noExpiredToken/" + JSON.parse('<%- token %>'), false);
        noExpiredToken.send(null);
        if(checkToken.responseText == ""){
            text.innerHTML = "Votre compte est expiré";
            throw 'Votre compte est expiré';
        }

        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("POST", JSON.parse('<%- api_user %>') + "/validMail/" + JSON.parse('<%- token %>'), true);
        xmlHttp.send(null);
        document.getElementById("text").innerHTML = "Votre mail est bien confirmé !";
    </script>
</body>